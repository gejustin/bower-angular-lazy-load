!function(root,factory){"function"==typeof define&&define.amd?define([],function(){return factory()}):"object"==typeof exports?module.exports=factory():factory()}(this,function(){function LazyLoadProvider(){function setTestsCache(cache){return testsCache=window.angular.extend({},testsCache,validateCache(cache)),this}function setCallbacksCache(cache){return callbacksCache=window.angular.extend({},callbacksCache,validateCache(cache)),this}function disableLazyLoading(){return disabled=!0,this}function validateCache(cache){if(!window.angular.isObject(cache))throw"Function cache must be an object.";return window.angular.forEach(cache,function(fn,alias){if(!window.angular.isFunction(fn))throw"Invalid argument for "+alias+". "+fn+" is not a function."}),cache}var callbacksCache={EMPTY:function(){}},testsCache={IN_VIEW:function(element,params,options){function isVerticallyVisible(offset){return bounds.top+offset<window.innerHeight&&bounds.bottom>0}function isHorizontallyVisible(offset){return bounds.left+offset<window.innerWidth&&bounds.right-offset>0}var bounds=element.getBoundingClientRect();return isVerticallyVisible(-100)&&isHorizontallyVisible(-3*window.innerWidth)}},disabled=!1;return{disableLazyLoading:disableLazyLoading,setCallbacksCache:setCallbacksCache,setTestsCache:setTestsCache,$get:["$window","$timeout","lazyLoadUtils",function($window,$timeout,lazyLoadUtils){return{lazyLoad:function(element,params,options){function executeCallbacks(){settings.callbacks.forEach(function(fn){if($window.angular.isFunction(fn))fn=fn;else{if(!$window.angular.isString(fn)||!$window.angular.isFunction(callbacksCache[fn]))throw"Callback function: "+fn+" is not defined.";fn=callbacksCache[fn]}$timeout(function(){fn.apply(element,args)})})}function runTests(){return settings.tests.some(function(fn){return $window.angular.isString(fn)&&$window.angular.isFunction(testsCache[fn])&&(fn=testsCache[fn]),$window.angular.isFunction(fn)&&fn.apply(element,args)})}function updateEvents(fn){settings.eventTypes.forEach(function(eventType){fn(eventType,eventObj,!1)})}var eventObj,defaults={tests:[testsCache.IN_VIEW],eventTypes:["scroll"],callbacks:[callbacksCache.EMPTY],forceEvent:!1,eventDelay:0},settings=$window.angular.extend($window.angular.copy(defaults),lazyLoadUtils.validateOptions(options)),args=arguments;!settings.forceEvent&&runTests()||disabled?executeCallbacks():(eventObj={handleEvent:lazyLoadUtils.debounce(function(){runTests()&&(executeCallbacks(),this.removeEvent())},settings.eventDelay),removeEvent:function(){updateEvents($window.removeEventListener)}},updateEvents($window.addEventListener))}}}]}}function LazyLoadDirectiveElement($window,lazyLoad,lazyLoadUtils){return{restrict:"E",transclude:!0,scope:{testCache:"@",callbackCache:"@",eventTypes:"@",forceEvent:"@",eventDelay:"@",params:"="},compile:function(tElement,tAttributes){return{pre:function(scope,iElement,iAttributes,controller,transcludeFn){lazyLoad.lazyLoad(iElement[0],scope.params,{tests:lazyLoadUtils.parseAttributeToArray(scope.testCache),callbacks:lazyLoadUtils.parseAttributeToArray(scope.callbackCache).concat([function(){iElement.append(transcludeFn())}]),eventTypes:lazyLoadUtils.parseAttributeToArray(scope.eventTypes),forceEvent:scope.forceEvent,eventDelay:$window.parseInt(scope.eventDelay)})}}}}}function LazyLoadDirectiveAttribute($window,lazyLoad,lazyLoadUtils){return{restrict:"A",scope:{testCache:"@",callbackCache:"@",eventTypes:"@",forceEvent:"@",eventDelay:"@",params:"="},compile:function(tElement,tAttributes){return{pre:function(scope,iElement,iAttributes){lazyLoad.lazyLoad(iElement[0],scope.params,{tests:lazyLoadUtils.parseAttributeToArray(scope.testCache),callbacks:lazyLoadUtils.parseAttributeToArray(scope.callbackCache),eventTypes:lazyLoadUtils.parseAttributeToArray(scope.eventTypes),forceEvent:scope.forceEvent,eventDelay:$window.parseInt(scope.eventDelay)})}}}}}function lazyLoadUtilsService($window){function debounce(func,wait){var timeout,args,context,timestamp;return function(){context=this,args=[].slice.call(arguments,0),timestamp=new Date;var later=function(){var last=new Date-timestamp;wait>last?timeout=setTimeout(later,wait-last):(timeout=null,func.apply(context,args))};timeout||(timeout=setTimeout(later,wait))}}function parseAttributeToArray(value){var result=[];return $window.angular.isString(value)?result=value.split(" ").filter(function(s){return!!s}):$window.angular.isArray(value)&&(result=value),result}function validateOptions(options){return $window.angular.forEach(options,function(value,key){(!options[key]||$window.angular.isArray(options[key])&&0===options[key].length)&&delete options[key]}),options}return{debounce:debounce,parseAttributeToArray:parseAttributeToArray,validateOptions:validateOptions}}window.angular.module("garyjustin.lazyLoad",[]),window.angular.module("garyjustin.lazyLoad").provider("lazyLoad",[LazyLoadProvider]),window.angular.module("garyjustin.lazyLoad").directive("lazyLoad",["$window","lazyLoad","lazyLoadUtils",LazyLoadDirectiveElement]).directive("lazyLoad",["$window","lazyLoad","lazyLoadUtils",LazyLoadDirectiveAttribute]),window.angular.module("garyjustin.lazyLoad").service("lazyLoadUtils",["$window",lazyLoadUtilsService])});